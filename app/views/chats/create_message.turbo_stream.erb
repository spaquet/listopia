<!-- app/views/chats/create_message.turbo_stream.erb
     Turbo Stream response for submitting a message to chat
     Appends user message and assistant response to message container
-->

<% if @user_message.present? %>
  <!-- Append user message -->
  <%= turbo_stream.append("chat-messages-#{@chat.id}") do %>
    <%= render "shared/chat_message", message: @user_message, chat_context: @chat_context %>
  <% end %>

  <!-- Append assistant response if present -->
  <% if @assistant_message.present? %>
    <%= turbo_stream.append("chat-messages-#{@chat.id}") do %>
      <%= render "shared/chat_message", message: @assistant_message, chat_context: @chat_context %>
    <% end %>
  <% end %>

  <!-- Clear the input field and restore focus -->
  <script>
    // Clear input field and refocus
    const input = document.querySelector('[data-unified-chat-target="messageInput"]');
    if (input) {
      input.value = '';
      input.focus();
    }

    // Auto-scroll to bottom
    const container = document.querySelector('[data-unified-chat-target="messagesContainer"]');
    if (container) {
      container.scrollTop = container.scrollHeight;
    }
  </script>
<% end %>
