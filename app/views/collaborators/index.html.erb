<!-- app/views/collaborators/index.html.erb -->
<div class="max-w-4xl mx-auto p-6">
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Manage Collaborators</h2>
      <p class="text-sm text-gray-600 mt-1">Control who can access and edit this <%= @collaboratable.class.name.downcase %></p>
    </div>
    <!-- Public Settings -->
    <% if @collaboratable.respond_to?(:is_public?) %>
      <div class="px-6 py-4 border-b border-gray-200">
        <%= form_with model: @collaboratable, local: false do |f| %>
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-sm font-medium text-gray-900">Public Access</h3>
              <p class="text-xs text-gray-500">Anyone with the link can access this list</p>
            </div>
            <div class="flex items-center space-x-3">
              <%= f.check_box :is_public, 
                    class: "rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",
                    onchange: "this.form.submit();" %>
              <% if @collaboratable.is_public? %>
                <%= f.select :public_permission,
                      options_for_select([
                        ['Read Only', 'public_read'],
                        ['Read & Write', 'public_write']
                      ], @collaboratable.public_permission),
                      {},
                      { class: "text-xs border-gray-300 rounded px-2 py-1",
                        onchange: "this.form.submit();" } %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    <!-- Add Collaborator Form -->
    <div class="px-6 py-4 border-b border-gray-200">
      <%= form_with url: collaborators_path, local: false, class: "space-y-4" do |f| %>
        <div class="flex space-x-3">
          <%= f.email_field :email, 
                placeholder: "Enter email address",
                class: "flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" %>
          <%= f.select "collaborator[permission]",
                options_for_select([
                  ['Read Only', 'read'],
                  ['Read & Write', 'write']
                ]),
                {},
                { class: "border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500" } %>
          <%= f.submit "Invite", 
                class: "bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
        </div>
      <% end %>
    </div>
    <!-- Current Collaborators -->
    <div class="px-6 py-4">
      <h3 class="text-sm font-medium text-gray-900 mb-3">Current Collaborators</h3>
      <% if @collaborators.any? %>
        <div class="space-y-3">
          <% @collaborators.each do |collaborator| %>
            <%= render 'collaborator', collaborator: collaborator %>
          <% end %>
        </div>
      <% else %>
        <p class="text-sm text-gray-500">No collaborators yet</p>
      <% end %>
    </div>
    <!-- Pending Invitations -->
    <% if @invitations.any? %>
      <div class="px-6 py-4 border-t border-gray-200">
        <h3 class="text-sm font-medium text-gray-900 mb-3">Pending Invitations</h3>
        <div class="space-y-3">
          <% @invitations.each do |invitation| %>
            <%= render 'invitation', invitation: invitation %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>